name: Publish Docs to Wiki

on:
  push:
    branches:
      - main
    paths:
      - 'docs/**'
      - '.github/workflows/publish-wiki.yml'

jobs:
  publish-wiki:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Checkout Wiki Repo
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository }}.wiki
          path: wiki

      - name: Sync Docs to Wiki
        run: |
          # Configure git
          cd wiki
          git config user.name "GitHub Action"
          git config user.email "action@github.com"
          
          # Clean existing content in wiki (excluding .git)
          # We use find to avoid deleting .git directory
          find . -maxdepth 1 -not -name '.git' -not -name '.' -exec rm -rf {} +
          
          # Copy docs content to wiki
          cp -r ../docs/* .
          
          # Rename README.md to Home.md for Wiki landing page
          if [ -f "README.md" ]; then
            mv README.md Home.md
          fi
          
          # Commit and push changes
          git add .
          if git diff --staged --quiet; then
            echo "No changes to commit"
          else
            git commit -m "Update Wiki content from docs/"
            git push
          fi
